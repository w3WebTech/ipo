<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IPO Details</title>
    <link href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Basic styling */
        .tabs {}
        .tab-titles {
            display: flex;
            margin-bottom: 10px;
            position: relative;
        }
        .tab {
            padding: 10px;
            cursor: pointer;
            flex: 1;
            text-align: center;
            transition: background-color 0.3s;
        }
        input[type="radio"] {
            display: none;
        }
        .tab-content .content {
            display: none;
        }
        #tab1:checked ~ .tab-titles ~ .tab-content #content1,
        #tab2:checked ~ .tab-titles ~ .tab-content #content2 {
            display: block;
        }
    </style>
</head>
<body>
    <div class="flex justify-center items-center absolute top-12 left-0 right-0">
        <div class="rounded-md border mt-5 bg-white shadow-lg w-full max-w-4xl min-h-screen">
            <div class="tabs px-5 py-3">
                <input type="radio" id="tab1" name="tab" checked />
                <input type="radio" id="tab2" name="tab" />
                <div class="tab-titles">
                    <label for="tab1" class="tab">Open & Upcoming</label>
                    <label for="tab2" class="tab">Your Application</label>
                </div>
                <div class="tab-content">
                    <div class="content" id="content1">
                        <h2 class="text-lg font-bold pt-4">Open IPO's</h2>
                        <div class="mx-auto sm:px-6 lg:px-8">
                            <ul id="companiesContainer" role="list" class="mt-6 grid grid-cols-1 gap-x-6 w-full gap-y-8 lg:grid-cols-3 xl:gap-x-8"></ul>
                        </div>
                    </div>
                    <div class="content" id="content2">
                        <h2 class="text-xl font-bold">Your Application</h2>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const apiUrl = "https://ipo.gwcindia.in/v3/api-ipo-master.php"; // Update with your API URL

        function sendDataToNewPage(company) {
            const queryParams = new URLSearchParams({
                name: company.ipoName,
                biddingStartDate: company.biddingStartDate,
                biddingEndDate: company.biddingEndDate,
                minPrice: company.minPrice.toString(),
                maxPrice: company.maxPrice.toString(),
                cutOffPrice: company.cutOffPrice,
                lotSize: company.lotSize,
                issueSize: company.issueSize,
                registrar: company.registrar,
                issueType: company.issueType,
                subType: company.subType,
                entryDate: company.entryDate,
                entryTime: company.entryTime,
            }).toString();

            window.location.href = `newipodetails.html?${queryParams}`;
        }

        function fetchCompanies() {
            fetch(apiUrl)
                .then((response) => response.json())
                .then((data) => {
                    if (Array.isArray(data.open)) {
                        const companiesContainer = document.getElementById("companiesContainer");
                        companiesContainer.innerHTML = ""; // Clear previous content

                        data.open.forEach((company) => {
                            const companyDiv = document.createElement("li");
                            companyDiv.classList.add("overflow-hidden", "rounded-xl", "border", "border-gray-200", "py-2", "clickable-div");

                            // Attach the event listener to the companyDiv
                            companyDiv.addEventListener("click", function () {
                                sendDataToNewPage(company);
                            });

                            companyDiv.innerHTML = `
                                <div class="flex items-center gap-x-4 border-gray-900/5 py-2 px-3">
                                    <img src="https://tailwindui.com/plus/img/logos/48x48/tuple.svg" alt ="${company.ipoName}" class="size-12 flex-none rounded-lg bg-white object-cover ring-1 ring-gray-900/10">
                                    <div>
                                        <div class="text-sm/6 font-medium text-gray-900">${company.ipoName}</div>
                                        <span class="rounded-md bg-indigo-50 px-2 py-1 text-xs font-medium text-indigo-700 ring-1 ring-inset ring-indigo-600/10">MAINBOARD</span>
                                    </div>
                                </div>
                                <dl class="-my-3 divide-y divide-gray-100 px-3 py-4 text-sm/6">
                                    <div class="flex justify-between gap-x-4 py-3">
                                        <div>
                                            <dt class="text-gray-500">Bidding Starts</dt>
                                            <dd class="text-gray-700 font-bold"><time datetime="${company.biddingStartDate}">${new Date(company.biddingStartDate).toLocaleDateString()}</time></dd>
                                        </div>
                                        <div>
                                            <dt class="text-gray-500 flex justify-end">Min Price</dt>
                                            <dd class="text-gray-700 font-bold flex justify-end"><time datetime="${company.biddingEndDate}">${company.minPrice}</time></dd>
                                        </div>
                                    </div>
                                    <div class="flex justify-between gap-x-4 p-3 rounded-md bg-gray-100">
                                        <dt class="text-gray-500"><span class="inline-flex items-center rounded-md bg-white px-1.5 py-0.5 text-xs font-medium text-gray-600">Issue Size</span></dt>
                                        <dt>
                                            <div class="font-bold text-gray-900">Max Price</div>
                                        </dt>
                                        <dd class="flex items-start gap-x-2">
                                            <div class="font-semibold text-green-600">${company.maxPrice}</div>
                                        </dd>
                                    </div>
                                </dl>
                            `;
                            companiesContainer.appendChild(companyDiv);
                        });
                    } else {
                        console.error("The API response does not contain an array of companies.");
                    }
                })
                .catch((error) => {
                    console.error("Error fetching companies:", error);
                });
        }

        fetchCompanies();

        const clientInfoUrl = "https://ipo.gwcindia.in/v3/api-client-info.php?clientCode=GZ10219"; // API for client info
        function fetchClientInfo() {
            fetch(clientInfoUrl)
                .then((response) => response.json())
                .then((data) => {
                    localStorage.setItem("clientInfo", JSON.stringify(data)); // Store the data in localStorage
                    console.log("Client info stored in localStorage:", data);
                })
                .catch((error) => {
                    console.error("Error fetching client info:", error);
                });
        }
        fetchClientInfo();
    </script>
</body>
</html>